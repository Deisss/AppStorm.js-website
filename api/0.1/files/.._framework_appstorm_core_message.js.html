<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
	<meta content="text/html; charset=utf-8" http-equiv="Content-Type" />
	<meta http-equiv="Content-Language" content="en" />
	<!-- Run IE in current version (not compatibility) mode -->
	<meta http-equiv="X-UA-Compatible" content="IE=edge" />

	<!-- Content information -->
	<meta name="description" content="AppStorm.JS is a framework for build fast and structured application" />
	<meta name="keywords" content="appstorm, appstorm.js, appstormjs, framework, framework-javascript, javascript, framework-js, js, appstorm-javascript" />
	<meta name="robots" content="index, follow, all" />
    <title>AppStorm.JS / API: ..\framework\appstorm\core\message.js</title>

	<!-- FAVICON -->
	<link rel="icon" type="image/png" href="http://appstormjs.com/site/favicon.png" />
	<!--[if IE]>
		<link rel="shortcut icon" type="image/x-icon" href="http://appstormjs.com/site/favicon.ico" />
	<![endif]-->

    <link rel="stylesheet" href="http://yui.yahooapis.com/3.8.0pr2/build/cssgrids/cssgrids-min.css">
	<link href="//netdna.bootstrapcdn.com/twitter-bootstrap/2.3.2/css/bootstrap-combined.min.css" rel="stylesheet">
    <link rel="stylesheet" href="../assets/vendor/prettify/prettify-min.css">
    <link rel="stylesheet" href="../assets/css/main.css" id="site_styles">
    <script src="http://yui.yahooapis.com/combo?3.8.0pr2/build/yui/yui-min.js"></script>
</head>
<body class="yui3-skin-sam">

<div id="doc">
    <div id="hd" class="yui3-g header">
        <div class="yui3-u-3-4">
            <h1><a href="../index.html"><img src="http://appstormjs.com/framework/logo/ajs.png">API</a></h1>
        </div>
        <div class="yui3-u-1-4 version">
            <em></em>
        </div>
    </div>

    <div>
		<div class="row-fluid">
			<div id="sidebar" class="span3">
				<div id="classes" class="sidebox">
    <div class="hd">
        <h2 class="no-toc">Classes</h2>
    </div>
    <div class="bd">
        <ul>
            
                <li><a href="../classes/a.html">a</a></li>
            
                <li><a href="../classes/a.ajax.html">a.ajax</a></li>
            
                <li><a href="../classes/a.callback.chainer.html">a.callback.chainer</a></li>
            
                <li><a href="../classes/a.callback.synchronizer.html">a.callback.synchronizer</a></li>
            
                <li><a href="../classes/a.console.html">a.console</a></li>
            
                <li><a href="../classes/a.environment.html">a.environment</a></li>
            
                <li><a href="../classes/a.eventEmitter.html">a.eventEmitter</a></li>
            
                <li><a href="../classes/a.form.html">a.form</a></li>
            
                <li><a href="../classes/a.keyboard.html">a.keyboard</a></li>
            
                <li><a href="../classes/a.language.html">a.language</a></li>
            
                <li><a href="../classes/a.loader.html">a.loader</a></li>
            
                <li><a href="../classes/a.message.html">a.message</a></li>
            
                <li><a href="../classes/a.page.event.html">a.page.event</a></li>
            
                <li><a href="../classes/a.page.event.hash.html">a.page.event.hash</a></li>
            
                <li><a href="../classes/a.page.template.html">a.page.template</a></li>
            
                <li><a href="../classes/a.parser.json.html">a.parser.json</a></li>
            
                <li><a href="../classes/a.parser.xml.html">a.parser.xml</a></li>
            
                <li><a href="../classes/a.state.html">a.state</a></li>
            
                <li><a href="../classes/a.state.helper.chainer.html">a.state.helper.chainer</a></li>
            
                <li><a href="../classes/a.state.helper.parameter.html">a.state.helper.parameter</a></li>
            
                <li><a href="../classes/a.state.helper.tree.html">a.state.helper.tree</a></li>
            
                <li><a href="../classes/a.state.type.html">a.state.type</a></li>
            
                <li><a href="../classes/a.storage.html">a.storage</a></li>
            
                <li><a href="../classes/a.storage.cookie.html">a.storage.cookie</a></li>
            
                <li><a href="../classes/a.storage.external.html">a.storage.external</a></li>
            
                <li><a href="../classes/a.storage.memory.html">a.storage.memory</a></li>
            
                <li><a href="../classes/a.storage.persistent.html">a.storage.persistent</a></li>
            
                <li><a href="../classes/a.storage.temporary.html">a.storage.temporary</a></li>
            
                <li><a href="../classes/a.storage.type.cookie.html">a.storage.type.cookie</a></li>
            
                <li><a href="../classes/a.storage.type.flash.html">a.storage.type.flash</a></li>
            
                <li><a href="../classes/a.storage.type.globalStorage.html">a.storage.type.globalStorage</a></li>
            
                <li><a href="../classes/a.storage.type.javafx.html">a.storage.type.javafx</a></li>
            
                <li><a href="../classes/a.storage.type.localStorage.html">a.storage.type.localStorage</a></li>
            
                <li><a href="../classes/a.storage.type.memory.html">a.storage.type.memory</a></li>
            
                <li><a href="../classes/a.storage.type.sessionStorage.html">a.storage.type.sessionStorage</a></li>
            
                <li><a href="../classes/a.storage.type.silverlight.html">a.storage.type.silverlight</a></li>
            
                <li><a href="../classes/a.storage.type.userData.html">a.storage.type.userData</a></li>
            
                <li><a href="../classes/a.timer.html">a.timer</a></li>
            
        </ul>
    </div>
</div>










<div id="fileTree" class="sidebox">
    <div class="hd">
        <h2 class="no-toc">Files</h2>
    </div>
    <div class="bd">
        <ul><li>..\framework\appstorm\a.js/<ul></ul></li><li>..\framework\appstorm\core\ajax.js/<ul></ul></li><li>..\framework\appstorm\core\console.js/<ul></ul></li><li>..\framework\appstorm\core\environment.js/<ul></ul></li><li>..\framework\appstorm\core\loader.js/<ul></ul></li><li>..\framework\appstorm\core\message.js/<ul></ul></li><li>..\framework\appstorm\core\parser.js/<ul></ul></li><li>..\framework\appstorm\core\timer.js/<ul></ul></li><li>..\framework\appstorm\plugin\callback.js/<ul></ul></li><li>..\framework\appstorm\plugin\form.js/<ul></ul></li><li>..\framework\appstorm\plugin\keyboard.js/<ul></ul></li><li>..\framework\appstorm\plugin\language.js/<ul></ul></li><li>..\framework\appstorm\plugin\page.js/<ul></ul></li><li>..\framework\appstorm\plugin\state.js/<ul></ul></li><li>..\framework\appstorm\plugin\storage.js/<ul></ul></li></ul>
    </div>
</div>



			</div>
			<div id="main" class="span9">
				<div class="content"><h4>..\framework\appstorm\core\message.js</h4>

<pre class="code prettyprint linenums">
/* ************************************************************************

	License: MIT Licence

	Authors: VILLETTE Charles

	Date: 2013-05-10

	Date of last modification: 2013-10-11

	Dependencies : [
		a.js
	]

	Events : [
		a.message.add {type : the type listeners (like &quot;a.storage.add&quot;), function : the associated function}
		a.message.remove {type : the type listeners (like &quot;a.storage.add&quot;), function : the associated function}
		a.message.removeAll {type : the type listeners (like &quot;a.storage.add&quot;)}
		a.message.clear {}
	]

	Description:
		Define one reusable object (eventEmitter) and create a root event system (message)
		( @see : http://simplapi.wordpress.com/2012/09/01/custom-event-listener-in-javascript/ )

************************************************************************ */


/**
 * Simple hash change checker to allow creating multi-page system
 *
 * Examples: &lt;a href=&quot;http://appstormjs.com/wiki/doku.php?id=appstorm.js_v0.1:core:message&quot;&gt;here&lt;/a&gt;
 *
 * @class eventEmitter
 * @constructor
 * @namespace a
*/
a.eventEmitter = (function() {
	&quot;use strict&quot;;

	var obj = function(){
		this.__list = {};
		this.__base = &quot;a.message&quot;;
	};

	/**
	 * Clear the unused (empty) types
	 *
	 * @method __clearEventType
	 * @private
	 *
	 * @param type {String} The type associated with current clearing
	*/
	function __clearEventType(type) {
		// At the end, we clear unused listeners array type (we must go backward for multi splice problem)
		for(var i in obj.__list) {
			if(obj.__list[i].length &lt; 1) {
				delete obj.__list[i];
			}
		}
	};

	/**
	 * Set the name of event root type, you can specify your own &quot;root name&quot; to identify more easily the event emitter
	 *
	 * @method setName
	 *
	 * @param name {String} The name to set (default is &quot;a.message&quot;)
	*/
	obj.prototype.setName = function(name) {
		this.__base = &quot;&quot; + name;
	};

	/**
	 * Adding a listener to a specific message type
	 *
	 * @method addListener
	 *
	 * @param type {String} The event name
	 * @param fn {Function} The function to attach
	*/
	obj.prototype.addListener = function(type, fn) {
		if(!a.isFunction(fn)) {
			a.console.warn(this.__base + &quot;.addListener : unable to bind function, this is not a function&quot;, 1);
			return;
		}

		if(a.isNull(this.__list[type])) {
			this.__list[type] = [];
		}
		this.__list[type].push(fn);

		// Dispatch event
		this.dispatch(this.__base + &quot;.add&quot;, {
			type : type,
			fct : fn
		});
	};

	/**
	 * Adding a listener only one
	 *
	 * @method addListenerOnce
	 *
	 * @param type {String} The event name
	 * @param fn {Function} The function to attach
	*/
	obj.prototype.addListenerOnce = function(type, fn) {
		var _this = this;

		var once = function(data) {
			fn(data);
			_this.removeListener(type, arguments.callee);
		};

		this.addListener(type, once);
	};

	/**
	 * Removing a listener to a specific message type
	 *
	 * @method removeListener
	 *
	 * @param type {String} The event name
	 * @param fn {Function} The function to detach
	*/
	obj.prototype.removeListener = function(type, fn) {
		// If the event type is not listed as existing, we don&#x27;t need to remove anything
		if(a.isNull(this.__list[type])) {
			return;
		}

		// Multiple splice : we must go backward to prevent index error
		var i = this.__list[type].length;
		if(a.isFunction(fn)) {
			while(i--) {
				if(this.__list[type][i] === fn) {
					this.__list[type].splice(i, 1);
				}
			}
		}

		// Dispatch event
		this.dispatch(this.__base + &quot;.remove&quot;, {
			type : type,
			fct : fn
		});

		// We clear unused list type
		__clearEventType(type);
	};

	/**
	 * Remove all listeners for a given type
	 *
	 * @method removeAllListeners
	 *
	 * @param type {String} The event type to remove
	*/
	obj.prototype.removeAllListeners = function(type) {
		if(!a.isNull(this.__list[type])) {
			this.__list[type] = [];

			// We clear unused list type
			__clearEventType(type);
		}
	};


	/**
	 * Clear all listeners from all event type
	 *
	 * @method clear
	*/
	obj.prototype.clear = function() {
		var c = this.__base + &quot;.clear&quot;;

		for(var i in this.__list) {
			if(i !== c) {
				delete this.__list[i];
			}
		}

		// Dispatch event
		this.dispatch(c, {});
	},

	/**
	 * Call an event, according to it&#x27;s type
	 *
	 * @method dispatch
	 *
	 * @param type {String} The event name to dispatch
	 * @param data {Object} Anything you want to pass threw this event
	*/
	obj.prototype.dispatch = function(type, data) {
		var t = this.__list[type];
		if(!a.isNull(t)) {
			for(var i=0, l=t.length; i&lt;l; ++i) {
				// Scoping to not have trouble
				(function(fct) {
					// Binding into timeout for not waiting function to finish
					setTimeout(function() {
						fct(data);
					}, 0);
				})(t[i]);
			}
		}
	};

	return obj;
}());


/**
 * The bus system to exchange message globally between all application object
 *
 * Examples: &lt;a href=&quot;http://appstormjs.com/wiki/doku.php?id=appstorm.js_v0.1:core:message&quot;&gt;here&lt;/a&gt;
 *
 * @class message
 * @static
 * @requires eventEmitter
 * @uses eventEmitter
 * @namespace a
*/
// Setting main event loop (general one where everybody can access it from everywhere)
a.message = new a.eventEmitter();
// Removing setName, unused on message object
a.message.setName = function(){};

</pre>

</div>
			</div>
		</div>
    </div>
</div>
<script src="../assets/vendor/prettify/prettify-min.js"></script>
<script>prettyPrint();</script>
<script src="../assets/js/yui-prettify.js"></script>
<script src="../assets/js/tabs.js"></script>
</body>
</html>
