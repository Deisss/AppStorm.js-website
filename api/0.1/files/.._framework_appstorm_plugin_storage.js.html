<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
	<meta content="text/html; charset=utf-8" http-equiv="Content-Type" />
	<meta http-equiv="Content-Language" content="en" />
	<!-- Run IE in current version (not compatibility) mode -->
	<meta http-equiv="X-UA-Compatible" content="IE=edge" />

	<!-- Content information -->
	<meta name="description" content="AppStorm.JS is a framework for build fast and structured application" />
	<meta name="keywords" content="appstorm, appstorm.js, appstormjs, framework, framework-javascript, javascript, framework-js, js, appstorm-javascript" />
	<meta name="robots" content="index, follow, all" />
    <title>AppStorm.JS / API: ..\framework\appstorm\plugin\storage.js</title>

	<!-- FAVICON -->
	<link rel="icon" type="image/png" href="http://appstormjs.com/site/favicon.png" />
	<!--[if IE]>
		<link rel="shortcut icon" type="image/x-icon" href="http://appstormjs.com/site/favicon.ico" />
	<![endif]-->

    <link rel="stylesheet" href="http://yui.yahooapis.com/3.8.0pr2/build/cssgrids/cssgrids-min.css">
	<link href="//netdna.bootstrapcdn.com/twitter-bootstrap/2.3.2/css/bootstrap-combined.min.css" rel="stylesheet">
    <link rel="stylesheet" href="../assets/vendor/prettify/prettify-min.css">
    <link rel="stylesheet" href="../assets/css/main.css" id="site_styles">
    <script src="http://yui.yahooapis.com/combo?3.8.0pr2/build/yui/yui-min.js"></script>
</head>
<body class="yui3-skin-sam">

<div id="doc">
    <div id="hd" class="yui3-g header">
        <div class="yui3-u-3-4">
            <h1><a href="../index.html"><img src="http://appstormjs.com/framework/logo/ajs.png">API</a></h1>
        </div>
        <div class="yui3-u-1-4 version">
            <em></em>
        </div>
    </div>

    <div>
		<div class="row-fluid">
			<div id="sidebar" class="span3">
				<div id="classes" class="sidebox">
    <div class="hd">
        <h2 class="no-toc">Classes</h2>
    </div>
    <div class="bd">
        <ul>
            
                <li><a href="../classes/a.html">a</a></li>
            
                <li><a href="../classes/a.ajax.html">a.ajax</a></li>
            
                <li><a href="../classes/a.callback.chainer.html">a.callback.chainer</a></li>
            
                <li><a href="../classes/a.callback.synchronizer.html">a.callback.synchronizer</a></li>
            
                <li><a href="../classes/a.console.html">a.console</a></li>
            
                <li><a href="../classes/a.environment.html">a.environment</a></li>
            
                <li><a href="../classes/a.eventEmitter.html">a.eventEmitter</a></li>
            
                <li><a href="../classes/a.form.html">a.form</a></li>
            
                <li><a href="../classes/a.keyboard.html">a.keyboard</a></li>
            
                <li><a href="../classes/a.language.html">a.language</a></li>
            
                <li><a href="../classes/a.loader.html">a.loader</a></li>
            
                <li><a href="../classes/a.message.html">a.message</a></li>
            
                <li><a href="../classes/a.page.event.html">a.page.event</a></li>
            
                <li><a href="../classes/a.page.event.hash.html">a.page.event.hash</a></li>
            
                <li><a href="../classes/a.page.template.html">a.page.template</a></li>
            
                <li><a href="../classes/a.parser.json.html">a.parser.json</a></li>
            
                <li><a href="../classes/a.parser.xml.html">a.parser.xml</a></li>
            
                <li><a href="../classes/a.state.html">a.state</a></li>
            
                <li><a href="../classes/a.state.helper.chainer.html">a.state.helper.chainer</a></li>
            
                <li><a href="../classes/a.state.helper.parameter.html">a.state.helper.parameter</a></li>
            
                <li><a href="../classes/a.state.helper.tree.html">a.state.helper.tree</a></li>
            
                <li><a href="../classes/a.state.type.html">a.state.type</a></li>
            
                <li><a href="../classes/a.storage.html">a.storage</a></li>
            
                <li><a href="../classes/a.storage.cookie.html">a.storage.cookie</a></li>
            
                <li><a href="../classes/a.storage.external.html">a.storage.external</a></li>
            
                <li><a href="../classes/a.storage.memory.html">a.storage.memory</a></li>
            
                <li><a href="../classes/a.storage.persistent.html">a.storage.persistent</a></li>
            
                <li><a href="../classes/a.storage.temporary.html">a.storage.temporary</a></li>
            
                <li><a href="../classes/a.storage.type.cookie.html">a.storage.type.cookie</a></li>
            
                <li><a href="../classes/a.storage.type.flash.html">a.storage.type.flash</a></li>
            
                <li><a href="../classes/a.storage.type.globalStorage.html">a.storage.type.globalStorage</a></li>
            
                <li><a href="../classes/a.storage.type.javafx.html">a.storage.type.javafx</a></li>
            
                <li><a href="../classes/a.storage.type.localStorage.html">a.storage.type.localStorage</a></li>
            
                <li><a href="../classes/a.storage.type.memory.html">a.storage.type.memory</a></li>
            
                <li><a href="../classes/a.storage.type.sessionStorage.html">a.storage.type.sessionStorage</a></li>
            
                <li><a href="../classes/a.storage.type.silverlight.html">a.storage.type.silverlight</a></li>
            
                <li><a href="../classes/a.storage.type.userData.html">a.storage.type.userData</a></li>
            
                <li><a href="../classes/a.timer.html">a.timer</a></li>
            
        </ul>
    </div>
</div>










<div id="fileTree" class="sidebox">
    <div class="hd">
        <h2 class="no-toc">Files</h2>
    </div>
    <div class="bd">
        <ul><li>..\framework\appstorm\a.js/<ul></ul></li><li>..\framework\appstorm\core\ajax.js/<ul></ul></li><li>..\framework\appstorm\core\console.js/<ul></ul></li><li>..\framework\appstorm\core\environment.js/<ul></ul></li><li>..\framework\appstorm\core\loader.js/<ul></ul></li><li>..\framework\appstorm\core\message.js/<ul></ul></li><li>..\framework\appstorm\core\parser.js/<ul></ul></li><li>..\framework\appstorm\core\timer.js/<ul></ul></li><li>..\framework\appstorm\plugin\callback.js/<ul></ul></li><li>..\framework\appstorm\plugin\form.js/<ul></ul></li><li>..\framework\appstorm\plugin\keyboard.js/<ul></ul></li><li>..\framework\appstorm\plugin\language.js/<ul></ul></li><li>..\framework\appstorm\plugin\page.js/<ul></ul></li><li>..\framework\appstorm\plugin\state.js/<ul></ul></li><li>..\framework\appstorm\plugin\storage.js/<ul></ul></li></ul>
    </div>
</div>



			</div>
			<div id="main" class="span9">
				<div class="content"><h4>..\framework\appstorm\plugin\storage.js</h4>

<pre class="code prettyprint linenums">
&quot;use strict&quot;;
/* ************************************************************************

	Version: 0.4

	License: MIT Licence

	Authors: VILLETTE Charles

	Date: 2013-05-14

	Date of last modification: 2013-06-03

	Dependencies : [
		a.js
	]

	Events : [
		a.storage.add : {key : the key, value : the value}
		a.storage.remove : {key : the key}
		a.storage.temporary.change : {engine : the engine choosed by system}
		a.storage.persistent.change : {engine : the engine choosed by system}
	]

	Description:
		Storage capacities, allow to manage many storage to get quick access to everything

		cookie : Cookie functionnality, manipulate cookie with a simplified interface
		temporary : Use the &quot;most powerfull&quot; system in the whole list of temporary store available

************************************************************************ */
/**
 * Storage capacities, allow to manage many storage to get quick access to everything
 *
 * Examples: &lt;a href=&quot;http://appstormjs.com/wiki/doku.php?id=appstorm.js_v0.1:plugins:storage&quot;&gt;here&lt;/a&gt;
 *
 * @class storage
 * @static
 * @namespace a
*/
a.storage = {
	/**
	 * Debug on console the get item action
	 *
	 * @method __printGetItem
	 * @private
	 *
	 * @param element {String} The element (like cookie, localStorage, ...)
	 * @param key {String} The key to debug
	 * @param value {Mixed} The value to dump
	*/
	__printGetItem : function(element, key, value) {
		if(key !== &quot;__test_support&quot;) {
			a.console.log(&quot;a.storage.type.&quot; + element + &quot;.getItem: get element (key: &quot; + key + &quot;, value: &quot; + value + &quot;)&quot;, 3);
		}
	},

	/**
	 * Debug on console the get item error action
	 *
	 * @method __printGetErrorItem
	 * @private
	 *
	 * @param element {String} The element (like cookie, localStorage, ...)
	 * @param key {String} The key to debug
	*/
	__printGetErrorItem : function(element, key) {
		if(key !== &quot;__test_support&quot;) {
			a.console.log(&quot;a.storage.type.&quot; + element + &quot;.getItem: unable to find key (&quot; + key + &quot;) in store&quot;, 2);
		}
	},

	/**
	 * Debug on console the set item action
	 *
	 * @method __printSetItem
	 * @private
	 *
	 * @param element {String} The element (like cookie, localStorage, ...)
	 * @param key {String} The key to debug
	 * @param value {Mixed} The value to dump
	*/
	__printSetItem : function(element, key, value) {
		if(key !== &quot;__test_support&quot;) {
			a.console.log(&quot;a.storage.type.&quot; + element + &quot;.setItem: add element (key: &quot; + key + &quot;, value: &quot; + value + &quot;)&quot;, 3);
		}
	},

	/**
	 * Debug on console the remove item action
	 *
	 * @method __printRemoveItem
	 * @private
	 *
	 * @param element {String} The element (like cookie, localStorage, ...)
	 * @param key {String} The key to debug
	*/
	__printRemoveItem : function(element, key) {
		if(key !== &quot;__test_support&quot;) {
			a.console.log(&quot;a.storage.type.&quot; + element + &quot;.removeItem: remove element (key: &quot; + key + &quot;)&quot;, 3);
		}
	},

	// Access to individual storage
	type:{}
};



/**
 * Cookie functionnality, manipulate cookie with a simplified interface
 *
 * Examples: &lt;a href=&quot;http://appstormjs.com/wiki/doku.php?id=appstorm.js_v0.1:plugins:storage&quot;&gt;here&lt;/a&gt;
 *
 * @class cookie
 * @static
 * @namespace a.storage.type
*/
a.storage.type.cookie = (function() {
	&quot;use strict&quot;;

	// Temporary desactivate event while making test
	var __active = false;

	// Define an object, but create some usefull data inside like &quot;isEnabled&quot; data which indicate support or not of cookies
	var obj = {
		/**
		 * @property support
		 * @type Boolean
		 * @default false
		*/
		support : false,
		/**
		 * @property engine
		 * @type String
		 * @default cookie
		 * @final
		*/
		engine  : &quot;cookie&quot;,
		/**
		 * Set a new cookie, or delete a cookie using a too old expires
		 *
		 * @method setItem
		 *
		 * @param name {String} The key to use
		 * @param value {Mixed} The value to store
		 * @param days {Integer} Number of days before expires
		*/
		setItem : function(name, value, days) {
			var expires = &quot;&quot;;
			a.storage.__printSetItem(&quot;cookie&quot;, name, value);
			if(days) {
				var date = new Date();
				date.setTime(date.getTime()+(days*24*60*60*1000));
				expires = &quot;; expires=&quot; + date.toGMTString();
			}
			document.cookie = name + &quot;=&quot; + escape(a.parser.json.stringify(value)) + expires + &quot;; path=/&quot;;
		},

		/**
		 * Get the stored cookie, return null if something went wrong
		 *
		 * @method getItem
		 *
		 * @param name {String} The cookie name stored
		 * @return {Mixed} Any data stored inside cookie
		*/
		getItem : function(name) {
			if (document.cookie.length &gt; 0) {
				var c_start = document.cookie.indexOf(name + &quot;=&quot;);
				if (c_start != -1) {
					c_start = c_start + name.length + 1;
					var c_end = document.cookie.indexOf(&quot;;&quot;, c_start);
					if (c_end == -1) {
						c_end = document.cookie.length;
					}
					var result = a.parser.json.parse(unescape(document.cookie.substring(c_start, c_end)));
					a.storage.__printGetItem(&quot;cookie&quot;, name, result);
					return result;
				}
			}
			a.storage.__printGetErrorItem(&quot;cookie&quot;, name);
			return null;
		},

		/**
		 * Remove a previously stored cookie
		 *
		 * @method removeItem
		 *
		 * @param name {String} The cookie name to delete
		*/
		removeItem : function(name) {
			a.storage.__printRemoveItem(&quot;cookie&quot;, name);
			this.setItem(name, &quot;&quot;, -1);

			// Dispatch event
			if(__active) {
				a.message.dispatch(&quot;a.storage.remove&quot;, {
					key : name
				});
			}
		}
	};

	// Cookie
	// Testing the current
	var test = &quot;__test_support&quot;;
	obj.setItem(test, &quot;ok&quot;);

	// Test system is working
	if(obj.getItem(test) === &quot;ok&quot;) {
		obj.removeItem(test);
		obj.support = true;
	}

	// Activate event
	__active = true;

	return obj;
})();


/**
 * Cookie functionnality, manipulate cookie with a simplified interface
 *
 * Examples: &lt;a href=&quot;http://appstormjs.com/wiki/doku.php?id=appstorm.js_v0.1:plugins:storage&quot;&gt;here&lt;/a&gt;
 *
 * @class cookie
 * @static
 * @namespace a.storage
*/
a.storage.cookie = a.storage.type.cookie;





/**
 * LocalStorage HTML5 support
 *
 * Examples: &lt;a href=&quot;http://appstormjs.com/wiki/doku.php?id=appstorm.js_v0.1:plugins:storage&quot;&gt;here&lt;/a&gt;
 *
 * @class localStorage
 * @static
 * @namespace a.storage.type
*/
a.storage.type.localStorage = (function() {
	&quot;use strict&quot;;

	var __support = false,
		__idTest  = &quot;__test_support&quot;,
		__ls      = &quot;localStorage&quot;;

	// Test support (if you use localStorageShim this should work for most of browsers (including old IE) !)
	if(__ls in window &amp;&amp; window[__ls] !== null) {
		// Testing database work or not
		window.localStorage.setItem(__idTest, &quot;o&quot;);

		// Test system is working
		if(window.localStorage.getItem(__idTest) === &quot;o&quot;) {
			window.localStorage.removeItem(__idTest);
			__support = true;
		}
	}

	return {
		/**
		 * @property support
		 * @type Boolean
		 * @default false
		*/
		support : __support,
		/**
		 * @property engine
		 * @type String
		 * @default localStorage
		 * @final
		*/
		engine  : __ls,
		/**
		 * Get the stored key
		 *
		 * @method getItem
		 *
		 * @param key {String} The key to retrieve
		 * @return {Mixed | null} The value in case of success, null if not found
		*/
		getItem : function(key) {
			if(__support) {
				var item = window.localStorage.getItem(key);
				if(a.isNull(item)) {
					a.storage.__printGetErrorItem(&quot;localStorage&quot;, key);
					return null;
				}
				var value = a.parser.json.parse(item);
				a.storage.__printGetItem(&quot;localStorage&quot;, key, value);
				return value;
			}
			return null;
		},
		/**
		 * Store a new key/value pair
		 *
		 * @method setItem
		 *
		 * @param key {String} The key to set
		 * @param value {Mixed} The data to add
		*/
		setItem : function(key, value) {
			if(__support) {
				a.storage.__printSetItem(&quot;localStorage&quot;, key, value);
				window.localStorage.setItem(key, a.parser.json.stringify(value));
				a.message.dispatch(&quot;a.storage.add&quot;, {
					key : key,
					value : value
				});
			}
		},
		/**
		 * Remove a given key from store
		 *
		 * @method removeItem
		 *
		 * @param key {String} The key to remove
		*/
		removeItem : function(key) {
			if(__support) {
				a.storage.__printRemoveItem(&quot;localStorage&quot;, key);
				window.localStorage.removeItem(key);
				a.message.dispatch(&quot;a.storage.remove&quot;, {
					key : key
				});
			}
		}
	};
})();



/**
 * globalStorage HTML5 support (old)
 *
 * Examples: &lt;a href=&quot;http://appstormjs.com/wiki/doku.php?id=appstorm.js_v0.1:plugins:storage&quot;&gt;here&lt;/a&gt;
 *
 * @class globalStorage
 * @static
 * @namespace a.storage.type
*/
a.storage.type.globalStorage = (function() {
	&quot;use strict&quot;;

	var __support  = false,
		__idTest   = &quot;__test_support&quot;,
		__hostname = window.location.hostname;

	if(!a.isNull(window.globalStorage)) {
		window.globalStorage[__hostname].setItem(__idTest, &quot;ok&quot;);

		// Test system is working
		if(window.globalStorage[__hostname].getItem(__idTest) == &quot;ok&quot;) {
			window.globalStorage[__hostname].removeItem(__idTest);
			__support = true;
		}
	}

	return {
		/**
		 * @property support
		 * @type Boolean
		 * @default false
		*/
		support : __support,
		/**
		 * @property engine
		 * @type String
		 * @default globalStorage
		 * @final
		*/
		engine  : &quot;globalStorage&quot;,
		/**
		 * Get the stored key
		 *
		 * @method getItem
		 *
		 * @param key {String} The key to retrieve
		 * @return {Mixed | null} The value in case of success, null if not found
		*/
		getItem : function(key) {
			if(__support) {
				var item = window.globalStorage[__hostname].getItem(key);
				// On some system, item will be an object with &quot;value&quot; and &quot;secure&quot; property
				if(a.isObject(item) &amp;&amp; !a.isNull(item.value)) {
					var value = a.parser.json.parse(item.value);
					a.storage.__printGetItem(&quot;globalStorage&quot;, key, value);
					return value;
				} else if(!a.isNull(item)) {
					var value = a.parser.json.parse(item);
					a.storage.__printGetItem(&quot;globalStorage&quot;, key, value);
					return value;
				} else {
					a.storage.__printGetErrorItem(&quot;globalStorage&quot;, key);
					return null;
				}
			}
			return null;
		},
		/**
		 * Store a new key/value pair
		 *
		 * @method setItem
		 *
		 * @param key {String} The key to set
		 * @param value {Mixed} The data to add
		*/
		setItem : function(key, value) {
			if(__support) {
				a.storage.__printSetItem(&quot;globalStorage&quot;, key, value);
				window.globalStorage[__hostname].setItem(key, a.parser.json.stringify(value));
				a.message.dispatch(&quot;a.storage.add&quot;, {
					key : key,
					value : value
				});
			}
		},
		/**
		 * Remove a given key from store
		 *
		 * @method removeItem
		 *
		 * @param key {String} The key to remove
		*/
		removeItem : function(key) {
			if(__support) {
				a.storage.__printRemoveItem(&quot;globalStorage&quot;, key);
				window.globalStorage[__hostname].removeItem(key);
				a.message.dispatch(&quot;a.storage.remove&quot;, {
					key : key
				});
			}
		}
	};
})();



/**
 * memory object (so if page close, everything is lost)
 *
 * Examples: &lt;a href=&quot;http://appstormjs.com/wiki/doku.php?id=appstorm.js_v0.1:plugins:storage&quot;&gt;here&lt;/a&gt;
 *
 * @class memory
 * @static
 * @namespace a.storage.type
*/
a.storage.type.memory = (function() {
	&quot;use strict&quot;;

	var __data = {};

	return {
		/**
		 * @property support
		 * @type Boolean
		 * @default true
		*/
		support : true,
		/**
		 * @property engine
		 * @type String
		 * @default memory
		 * @final
		*/
		engine  : &quot;memory&quot;,
		/**
		 * Get the stored key
		 *
		 * @method getItem
		 *
		 * @param key {String} The key to retrieve
		 * @return {Mixed | null} The value in case of success, null if not found
		*/
		getItem : function(key) {
			var value = __data[key];
			if(!a.isNull(value)) {
				a.storage.__printGetItem(&quot;memory&quot;, key, value);
				a.console.log(&quot;a.storage.memory.getItem: found item (key: &quot; + key + &quot;, value: &quot; + value + &quot;)&quot;, 3);
				return value;
			}
			a.storage.__printGetErrorItem(&quot;memory&quot;, key);
			return null;
		},
		/**
		 * Store a new key/value pair
		 *
		 * @method setItem
		 *
		 * @param key {String} The key to set
		 * @param value {Mixed} The data to add
		*/
		setItem : function(key, value) {
			__data[key] = value;
			a.storage.__printSetItem(&quot;memory&quot;, key, value);
			a.message.dispatch(&quot;a.storage.add&quot;, {
				key : key,
				value : value
			});
		},
		/**
		 * Remove a given key from store
		 *
		 * @method removeItem
		 *
		 * @param key {String} The key to remove
		*/
		removeItem : function(key) {
			a.storage.__printRemoveItem(&quot;memory&quot;, key);
			if(!a.isNull(__data[key])) {
				delete __data[key];
				a.message.dispatch(&quot;a.storage.remove&quot;, {
					key : key
				});
			}
		}
	}
})();


/**
 * Memory store functionnality, manipulate memory storage class with a simplified interface
 *
 * Examples: &lt;a href=&quot;http://appstormjs.com/wiki/doku.php?id=appstorm.js_v0.1:plugins:storage&quot;&gt;here&lt;/a&gt;
 *
 * @class memory
 * @static
 * @namespace a.storage
*/
a.storage.memory = a.storage.type.memory;





/**
 * sessionStorage HTML5 support
 *
 * Examples: &lt;a href=&quot;http://appstormjs.com/wiki/doku.php?id=appstorm.js_v0.1:plugins:storage&quot;&gt;here&lt;/a&gt;
 *
 * @class sessionStorage
 * @static
 * @namespace a.storage.type
*/
a.storage.type.sessionStorage = (function() {
	&quot;use strict&quot;;

	var __support = false,
		__idTest  = &quot;__test_support&quot;,
		__ss      = &quot;sessionStorage&quot;;


	// Test support
	if(__ss in window &amp;&amp; !a.isNull(window[__ss])) {
		// Testing database work or not
		window.sessionStorage.setItem(__idTest, &quot;o&quot;);

		// Test system is working
		if(window.sessionStorage.getItem(__idTest) === &quot;o&quot;) {
			window.sessionStorage.removeItem(__idTest);
			__support = true;
		}
	}

	return {
		/**
		 * @property support
		 * @type Boolean
		 * @default false
		*/
		support : __support,
		/**
		 * @property engine
		 * @type String
		 * @default sessionStorage
		 * @final
		*/
		engine  : __ss,
		/**
		 * Get the stored key
		 *
		 * @method getItem
		 *
		 * @param key {String} The key to retrieve
		 * @return {Mixed | null} The value in case of success, null if not found
		*/
		getItem : function(key) {
			if(__support) {
				var item = window.sessionStorage.getItem(key);
				if(a.isNull(item)) {
					a.storage.__printGetErrorItem(&quot;sessionStorage&quot;, key);
					return null;
				}
				var value = a.parser.json.parse(item);
				a.storage.__printGetItem(&quot;sessionStorage&quot;, key, value);
				return value;
			}
			return null;
		},
		/**
		 * Store a new key/value pair
		 *
		 * @method setItem
		 *
		 * @param key {String} The key to set
		 * @param value {Mixed} The data to add
		*/
		setItem : function(key, value) {
			if(__support) {
				a.storage.__printSetItem(&quot;sessionStorage&quot;, key, value);
				window.sessionStorage.setItem(key, a.parser.json.stringify(value));
				a.message.dispatch(&quot;a.storage.add&quot;, {
					key : key,
					value : value
				});
			}
		},
		/**
		 * Remove a given key from store
		 *
		 * @method removeItem
		 *
		 * @param key {String} The key to remove
		*/
		removeItem : function(key) {
			if(__support) {
				a.storage.__printRemoveItem(&quot;sessionStorage&quot;, key);
				window.sessionStorage.removeItem(key);
				a.message.dispatch(&quot;a.storage.remove&quot;, {
					key : key
				});
			}
		}
	};
})();




/**
 * userData IE support (old)
 *
 * Examples: &lt;a href=&quot;http://appstormjs.com/wiki/doku.php?id=appstorm.js_v0.1:plugins:storage&quot;&gt;here&lt;/a&gt;
 *
 * @class userData
 * @static
 * @namespace a.storage.type
*/
a.storage.type.userData = (function() {
	&quot;use strict&quot;;

	var __support = false,
		__idTest  = &quot;__test_support&quot;,
		uid       = &quot;a_storage&quot;,
		dbName    = &quot;aUserDataStorage&quot;;

	// Store for internet explorer

	// Test support
	if(document.all) {
		// On some IE, db.load and db.save may be disabled (binary behavior disable)...
		try {
			// Creating userData storage
			document.write(&#x27;&lt;input type=&quot;hidden&quot; id=&quot;&#x27; + uid + &#x27;&quot; style=&quot;display:none;behavior:url(\&#x27;#default#userData\&#x27;)&quot; /&gt;&#x27;);
			var db = document.getElementById(uid);
			db.load(dbName);

			// Testing work before setting as default
			db.setAttribute(__idTest, &quot;ok&quot;);
			db.save(dbName);

			// Test system is working
			if(db.getAttribute(__idTest) === &quot;ok&quot;) {
				// Deleting test
				db.removeAttribute(__idTest);
				db.save(dbName);

				__support = true;
			}
		} catch(e) {
			__support = false;
		}
	}

	return {
		/**
		 * @property support
		 * @type Boolean
		 * @default false
		*/
		support : __support,
		/**
		 * @property engine
		 * @type String
		 * @default userData
		 * @final
		*/
		engine  : &quot;userData&quot;,
		/**
		 * Get the stored key
		 *
		 * @method getItem
		 *
		 * @param key {String} The key to retrieve
		 * @return {Mixed | null} The value in case of success, null if not found
		*/
		getItem : function(key) {
			if(__support) {
				var value = a.parser.json.parse(db.getAttribute(key));
				if(a.isNull(value)) {
					a.storage.__printGetErrorItem(&quot;userData&quot;, key);
					return null;
				}
				a.storage.__printGetItem(&quot;userData&quot;, key, value);
				return value;
			}
			return null;
		},
		/**
		 * Store a new key/value pair
		 *
		 * @method setItem
		 *
		 * @param key {String} The key to set
		 * @param value {Mixed} The data to add
		*/
		setItem : function(key, value) {
			if(__support) {
				a.storage.__printSetItem(&quot;userData&quot;, key, value);
				db.setAttribute(key, a.parser.json.stringify(value));
				db.save(dbName);
				a.message.dispatch(&quot;a.storage.add&quot;, {
					key : key,
					value : value
				});
			}
		},
		/**
		 * Remove a given key from store
		 *
		 * @method removeItem
		 *
		 * @param key {String} The key to remove
		*/
		removeItem : function(key) {
			if(__support) {
				a.storage.__printRemoveItem(&quot;userData&quot;, key);
				db.removeAttribute(key);
				db.save(dbName);
				a.message.dispatch(&quot;a.storage.remove&quot;, {
					key : key
				});
			}
		}
	};
})();



/**
 * flash external storage
 *
 * Examples: &lt;a href=&quot;http://appstormjs.com/wiki/doku.php?id=appstorm.js_v0.1:plugins:storage&quot;&gt;here&lt;/a&gt;
 *
 * @class flash
 * @static
 * @namespace a.storage.type
*/
a.storage.type.flash = (function() {
	&quot;use strict&quot;;

	var __support = false,
		__ready   = false,
		__id      = &quot;flashstorage&quot;;

	/**
	 * Start flash and check availability
	 *
	 * @method __startFlash
	 * @private
	 * @async
	 *
	 * @param callback {Function | null} The callback function to call after loading
	*/
	function __startFlash(callback) {
		if(__support === false &amp;&amp; __ready === false) {
			// Append to root an object for recieving flash
			var root = document.createElement(&quot;div&quot;);
			root.id = &quot;flashstoragecontent&quot;;
			document.body.appendChild(root);

			var data = {
				id : __id,
				rootId : root.id,

				flashvars : {},
				params : {
					wmode: &quot;transparent&quot;,
					menu: &quot;false&quot;,
					scale: &quot;noScale&quot;,
					allowFullscreen: &quot;true&quot;,
					allowScriptAccess: &quot;always&quot;
				}
			};

			// Loading file
			a.loader.flash(a.url + &quot;vendor/storage/flash/localStorage.swf&quot;, function(e) {
				__ready = true;

				var el = document.getElementById(data.id);

				if(el.testData() === true) {
					__support = true;
					el.setDatabase(&quot;a_flashStorage&quot;);
				}
				if(__support === true &amp;&amp; a.isFunction(callback)) {
					callback(__support);
				}
			}, data);
		} else if(__support === true &amp;&amp; a.isFunction(callback)) {
			callback(__support);
		}
	};

	return {
		/**
		 * Get the support state of flash.
		 * Note: it may arrive little bit after using start function...
		 *
		 * @method support
		 *
		 * @return {Boolean} True if support is active, false in other cases
		*/
		support : function() {return __support;},
		/**
		 * Get the ready state of flash object
		 *
		 * @method ready
		 *
		 * @return {Boolean} True if it&#x27;s ready, false in other cases
		*/
		ready : function() {return __ready;},
		/**
		 * @property engine
		 * @type String
		 * @default flash
		 * @final
		*/
		engine : &quot;flash&quot;,

		/**
		 * Start (include and prepare) flash object
		 * Note: automatically done by system you don&#x27;t need to...
		 *
		 * @method start
		 * @async
		 *
		 * @param callback {Function} The function to call in case of success
		*/
		start : function(callback) {
			__startFlash(callback);
		},

		/**
		 * Get the stored key
		 *
		 * @method getItem
		 *
		 * @param key {String} The key to retrieve
		 * @return {Mixed | null} The value in case of success, null if not found
		*/
		getItem : function(key) {
			this.start();
			if(__support === true) {
				var item = document.getElementById(__id).getData(key);
				if(a.isNull(item)) {
					a.storage.__printGetErrorItem(&quot;flash&quot;, key);
					return null;
				}
				a.storage.__printGetItem(&quot;flash&quot;, key, item);
				return item;
			}
			return null;
		},

		/**
		 * Store a new key/value pair
		 *
		 * @method setItem
		 *
		 * @param key {String} The key to set
		 * @param value {Mixed} The data to add
		*/
		setItem : function(key, value) {
			this.start();
			if(__support === true) {
				a.storage.__printSetItem(&quot;flash&quot;, key, value);
				document.getElementById(__id).setData(key, value);
			}
		},

		/**
		 * Remove a given key from store
		 *
		 * @method removeItem
		 *
		 * @param key {String} The key to remove
		*/
		removeItem : function(key) {
			this.start();
			if(__support === true) {
				a.storage.__printRemoveItem(&quot;flash&quot;, key);
				return document.getElementById(__id).removeData(key);
			}
		}
	};
})();



/**
 * silverlight external storage
 *
 * Examples: &lt;a href=&quot;http://appstormjs.com/wiki/doku.php?id=appstorm.js_v0.1:plugins:storage&quot;&gt;here&lt;/a&gt;
 *
 * @class silverlight
 * @static
 * @namespace a.storage.type
*/
a.storage.type.silverlight = (function() {
	&quot;use strict&quot;;

	var __support = false,
		__ready   = false,
		__id      = &quot;silverlightstorage&quot;;

	/**
	 * Start silverlight and check availability
	 *
	 * @method __startSilverlight
	 * @private
	 * @async
	 *
	 * @param callback {Function | null} The callback function to call after loading
	*/
	function __startSilverlight(callback) {
		if(__support === false &amp;&amp; __ready === false) {
			// Append to root an object for recieving flash
			var root = document.createElement(&quot;div&quot;);
			root.id = &quot;__silverlightstorage&quot;;
			document.body.appendChild(root);

			var data = {
				id : __id,
				rootId : root.id,

				params : [{
					name : &quot;minRuntimeVersion&quot;,
					value : &quot;2.0.31005.0&quot;
				},{
					name : &quot;autoUpgrade&quot;,
					value : &quot;true&quot;
				}]
			};

			// Loading file
			a.loader.silverlight(a.url + &quot;vendor/storage/silverlight/silverlightStorage.xap&quot;, function(e) {
				__ready = true;

				var el = document.getElementById(data.id);
				if(el.Content.store.testData() === true) {
					__support = true;
				}
				if(__support === true &amp;&amp; a.isFunction(callback)) {
					callback(__support);
				}
			}, data);
		} else if(__support === true &amp;&amp; a.isFunction(callback)) {
			callback(__support);
		}
	};

	return {
		/**
		 * Get the support state of silverlight.
		 * Note: it may arrive little bit after using start function...
		 *
		 * @method support
		 *
		 * @return {Boolean} True if support is active, false in other cases
		*/
		support : function() {return __support;},
		/**
		 * Get the ready state of silverlight object
		 *
		 * @method ready
		 *
		 * @return {Boolean} True if it&#x27;s ready, false in other cases
		*/
		ready : function() {return __ready;},
		/**
		 * @property engine
		 * @type String
		 * @default silverlight
		 * @final
		*/
		engine : &quot;silverlight&quot;,

		/**
		 * Start (include and prepare) silverlight object
		 * Note: automatically done by system you don&#x27;t need to...
		 *
		 * @method start
		 * @async
		 *
		 * @param callback {Function} The function to call in case of success
		*/
		start : function(callback) {
			__startSilverlight(callback);
		},

		/**
		 * Get the stored key
		 *
		 * @method getItem
		 *
		 * @param key {String} The key to retrieve
		 * @return {Mixed | null} The value in case of success, null if not found
		*/
		getItem : function(key) {
			this.start();
			if(__support === true) {
				var item = document.getElementById(__id).Content.store.loadData(key);
				if(a.isNull(item) || item === &quot;false&quot;) {
					a.storage.__printGetErrorItem(&quot;silverlight&quot;, key);
					return null;
				}
				var value = a.parser.json.parse(item);
				a.storage.__printGetItem(&quot;silverlight&quot;, key, value);
				return value;
			}
			return null;
		},

		/**
		 * Store a new key/value pair
		 *
		 * @method setItem
		 *
		 * @param key {String} The key to set
		 * @param value {Mixed} The data to add
		*/
		setItem : function(key, value) {
			this.start();
			if(__support === true) {
				a.storage.__printSetItem(&quot;silverlight&quot;, key, value);
				document.getElementById(__id).Content.store.saveData(key, a.parser.json.stringify(value));
			}
		},

		/**
		 * Remove a given key from store
		 *
		 * @method removeItem
		 *
		 * @param key {String} The key to remove
		*/
		removeItem : function(key) {
			this.start();
			if(__support === true) {
				a.storage.__printRemoveItem(&quot;silverlight&quot;, key);
				document.getElementById(__id).Content.store.removeData(key);
			}
		}
	};
})();



/**
 * javafx external storage
 *
 * Examples: &lt;a href=&quot;http://appstormjs.com/wiki/doku.php?id=appstorm.js_v0.1:plugins:storage&quot;&gt;here&lt;/a&gt;
 *
 * @class javafx
 * @static
 * @namespace a.storage.type
*/
a.storage.type.javafx = (function() {
	&quot;use strict&quot;;

	var __support = false,
		__ready   = false,
		__id      = &quot;javafxstorage&quot;;

	/**
	 * Start javaFX and check availability
	 *
	 * @method __startJavaFX
	 * @private
	 * @async
	 *
	 * @param callback {Function | null} The callback function to call after loading
	*/
	function __startJavaFX(callback) {
		if(__support === false &amp;&amp; __ready === false) {
			var data = {
				code : &quot;javafxstorage.Main&quot;,
				id : &quot;javafxstorage&quot;
			};

			// Loading file
			a.loader.javafx(a.url + &quot;vendor/storage/javafx/JavaFXStorage.jar&quot;, function() {
				__ready = true;
				var t = document.getElementById(&quot;javafxstorage&quot;);

				if(t.Packages.javafxstorage.localStorage.testData() === true) {
					__support = true;
					el.setDatabase(&quot;a_javafxStorage&quot;);
				}
				
				if(__support === true &amp;&amp; a.isFunction(callback)) {
					callback(__support);
				}
			}, data);
		} else if(__support === true &amp;&amp; a.isFunction(callback)) {
			callback(__support);
		}
	};

	return {
		/**
		 * Get the support state of javafx.
		 * Note: it may arrive little bit after using start function...
		 *
		 * @method support
		 *
		 * @return {Boolean} True if support is active, false in other cases
		*/
		support : function() {return __support;},
		/**
		 * Get the ready state of javafx object
		 *
		 * @method ready
		 *
		 * @return {Boolean} True if it&#x27;s ready, false in other cases
		*/
		ready : function() {return __ready;},
		/**
		 * @property engine
		 * @type String
		 * @default javafx
		 * @final
		*/
		engine : &quot;javafx&quot;,

		/**
		 * Start (include and prepare) javafx object
		 * Note: automatically done by system you don&#x27;t need to...
		 *
		 * @method start
		 * @async
		 *
		 * @param callback {Function} The function to call in case of success
		*/
		start : function(callback) {
			__startJavaFX(callback);
		},

		/**
		 * Get the stored key
		 *
		 * @method getItem
		 *
		 * @param key {String} The key to retrieve
		 * @return {Mixed | null} The value in case of success, null if not found
		*/
		getItem : function(key) {
			this.start();
			if(__support === true) {
				var item = document.getElementById(__id).Packages.javafxstorage.localStorage.loadData(key);
				if(a.isNull(item) || item === &quot;false&quot;) {
					a.storage.__printGetErrorItem(&quot;javafx&quot;, key);
					return null;
				}
				var value = a.parser.json.parse(item);
				a.storage.__printGetItem(&quot;javafx&quot;, key, value);
				return value;
			}
			return null;
		},

		/**
		 * Store a new key/value pair
		 *
		 * @method setItem
		 *
		 * @param key {String} The key to set
		 * @param value {Mixed} The data to add
		*/
		setItem : function(key, value) {
			this.start();
			if(__support === true) {
				a.storage.__printSetItem(&quot;javafx&quot;, key, value);
				document.getElementById(__id).Packages.javafxstorage.localStorage.saveData(key, a.parser.json.stringify(value));
			}
		},

		/**
		 * Remove a given key from store
		 *
		 * @method removeItem
		 *
		 * @param key {String} The key to remove
		*/
		removeItem : function(key) {
			this.start();
			if(__support === true) {
				a.storage.__printRemoveItem(&quot;javafx&quot;, key);
				document.getElementById(__id).Packages.javafxstorage.localStorage.removeData(key);
			}
		}
	};
})();






/* *************************
  POPULATING DATA FOR TEMPORARY AND PERSIST
************************* */
// TEMPORARY STORE SEARCH
/**
 * Select the best temp storage available
 *
 * Examples: &lt;a href=&quot;http://appstormjs.com/wiki/doku.php?id=appstorm.js_v0.1:plugins:storage&quot;&gt;here&lt;/a&gt;
 *
 * @class temporary
 * @static
 * @namespace a.storage
*/
a.storage.temporary = (function() {
	&quot;use strict&quot;;

	var store = [&quot;sessionStorage&quot;, &quot;cookie&quot;, &quot;memory&quot;];
	for(var i=0, l=store.length; i&lt;l; ++i) {
		var temp = store[i];
		if(a.storage.type[temp].support) {
			a.console.log(&quot;a.storage.temporary: choosing storage &quot; + a.storage.type[temp].engine, 3);
			a.message.dispatch(&quot;a.storage.temporary.change&quot;, { engine : temp });
			return a.storage.type[temp];
		}
	}

	// Memory store should be always OK, so this should never arrive
	return null;
})();


// EXTERNAL STORE SEARCH
/**
 * Select the best external storage available
 *
 * Examples: &lt;a href=&quot;http://appstormjs.com/wiki/doku.php?id=appstorm.js_v0.1:plugins:storage&quot;&gt;here&lt;/a&gt;
 *
 * @class external
 * @static
 * @namespace a.storage
*/
a.storage.external = (function() {
	var __started = false;

	/**
	 * Start the callback function if possible
	 *
	 * @method __startCallback
	 * @private
	 * @async
	 *
	 * @param type {Object} The object to use for external
	 * @param callback {Function | null} The function to launch if a store has been found
	*/
	function __startCallback(type, callback) {
		a.storage.external.ready = type.ready;
		a.storage.external.support = type.support;
		a.storage.external.engine = type.engine;
		a.storage.external.getItem = type.getItem;
		a.storage.external.setItem = type.setItem;
		a.storage.external.removeItem = type.removeItem;

		if(a.isFunction(callback)) {
			callback();
		}
	};

	return {
		/**
		 * Start the external tool, try to find an available store
		 *
		 * @method start
		 * @async
		 *
		 * @param callback {Function | null} The function to launch if a store has been found
		*/
		start : function(callback) {
			var silvt = a.storage.type.silverlight,
				flash = a.storage.type.flash,
				javax = a.storage.type.javafx;

			var cs = &quot;a.storage.external: choosing storage &quot;;

			// Loading silverlight
			silvt.start(function(svtSupport) {
				if(svtSupport) {
					a.console.log(cs + &quot;silverlight&quot;, 3);
					__startCallback(silvt, callback);
				} else {
					// Loading flash
					flash.start(function(flashSupport) {
						if(flashSupport) {
							a.console.log(cs + &quot;flash&quot;, 3);
							__startCallback(flash, callback);
						} else {
							javax.start(function(javaxSupport) {
								if(javaxSupport) {
									a.console.log(cs + &quot;javafx&quot;, 3);
									__startCallback(javax, callback);
								} else {
									a.console.warn(cs + &quot;NONE AVAILABLE&quot;, 3);
								}
							});
						}
					});
				}
			});
		}
	};
}());


// PERSISTENT STORE SEARCH
/**
 * Select the best long term storage available
 *
 * Examples: &lt;a href=&quot;http://appstormjs.com/wiki/doku.php?id=appstorm.js_v0.1:plugins:storage&quot;&gt;here&lt;/a&gt;
 *
 * @class persistent
 * @static
 * @namespace a.storage
*/
a.storage.persistent = (function() {
	&quot;use strict&quot;;

	var store = [&quot;localStorage&quot;, &quot;globalStorage&quot;, &quot;userData&quot;, &quot;cookie&quot;];
	for(var i=0, l=store.length; i&lt;l; ++i) {
		var temp = store[i];
		if(a.storage.type[temp].support) {
			a.console.log(&quot;a.storage.persistent: choosing storage &quot; + a.storage.type[temp].engine, 3);
			a.message.dispatch(&quot;a.storage.persistent.change&quot;, { engine : temp });
			return a.storage.type[temp];
		}
	}

	// This one may append
	return null;
})();

if(a.storage.persistent == null) {
	a.storage.persistent = {};
	a.storage.persistent.support    = false;
	a.storage.persistent.engine     = function(){return &quot;none&quot;;};
	a.storage.persistent.getItem    = function(){return null;};
	a.storage.persistent.setItem    = function(){};
	a.storage.persistent.removeItem = function(){};
}

// Now storage himself got same as persistent
a.storage.support    = a.storage.persistent.support;
a.storage.engine     = a.storage.persistent.engine;
a.storage.getItem    = a.storage.persistent.getItem;
a.storage.setItem    = a.storage.persistent.setItem;
a.storage.removeItem = a.storage.persistent.removeItem;
</pre>

</div>
			</div>
		</div>
    </div>
</div>
<script src="../assets/vendor/prettify/prettify-min.js"></script>
<script>prettyPrint();</script>
<script src="../assets/js/yui-prettify.js"></script>
<script src="../assets/js/tabs.js"></script>
</body>
</html>
