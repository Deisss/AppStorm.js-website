<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
	<meta content="text/html; charset=utf-8" http-equiv="Content-Type" />
	<meta http-equiv="Content-Language" content="en" />
	<!-- Run IE in current version (not compatibility) mode -->
	<meta http-equiv="X-UA-Compatible" content="IE=edge" />

	<!-- Content information -->
	<meta name="description" content="AppStorm.JS is a framework for build fast and structured application" />
	<meta name="keywords" content="appstorm, appstorm.js, appstormjs, framework, framework-javascript, javascript, framework-js, js, appstorm-javascript" />
	<meta name="robots" content="index, follow, all" />
    <title>AppStorm.JS / API: ..\git\appstorm\plugin\form.js</title>

	<!-- FAVICON -->
	<link rel="icon" type="image/png" href="http://appstormjs.com/site/favicon.png" />
	<!--[if IE]>
		<link rel="shortcut icon" type="image/x-icon" href="http://appstormjs.com/site/favicon.ico" />
	<![endif]-->

    <link rel="stylesheet" href="http://yui.yahooapis.com/3.8.0pr2/build/cssgrids/cssgrids-min.css">
	<link href="//netdna.bootstrapcdn.com/twitter-bootstrap/2.3.2/css/bootstrap-combined.min.css" rel="stylesheet">
    <link rel="stylesheet" href="../assets/vendor/prettify/prettify-min.css">
    <link rel="stylesheet" href="../assets/css/main.css" id="site_styles">
    <script src="http://yui.yahooapis.com/combo?3.8.0pr2/build/yui/yui-min.js"></script>
</head>
<body class="yui3-skin-sam">

<div id="doc">
    <div id="hd" class="yui3-g header">
        <div class="yui3-u-3-4">
            <h1><a href="../index.html"><img src="http://appstormjs.com/git/logo/ajs.png">API</a></h1>
        </div>
        <div class="yui3-u-1-4 version">
            <em></em>
        </div>
    </div>

    <div>
		<div class="row-fluid">
			<div id="sidebar" class="span3">
				<div id="classes" class="sidebox">
    <div class="hd">
        <h2 class="no-toc">Classes</h2>
    </div>
    <div class="bd">
        <ul>
            
                <li><a href="../classes/a.html">a</a></li>
            
                <li><a href="../classes/a.ajax.html">a.ajax</a></li>
            
                <li><a href="../classes/a.callback.chainer.html">a.callback.chainer</a></li>
            
                <li><a href="../classes/a.callback.synchronizer.html">a.callback.synchronizer</a></li>
            
                <li><a href="../classes/a.console.html">a.console</a></li>
            
                <li><a href="../classes/a.environment.html">a.environment</a></li>
            
                <li><a href="../classes/a.eventEmitter.html">a.eventEmitter</a></li>
            
                <li><a href="../classes/a.form.html">a.form</a></li>
            
                <li><a href="../classes/a.keyboard.html">a.keyboard</a></li>
            
                <li><a href="../classes/a.language.html">a.language</a></li>
            
                <li><a href="../classes/a.loader.html">a.loader</a></li>
            
                <li><a href="../classes/a.message.html">a.message</a></li>
            
                <li><a href="../classes/a.page.event.html">a.page.event</a></li>
            
                <li><a href="../classes/a.page.event.hash.html">a.page.event.hash</a></li>
            
                <li><a href="../classes/a.page.template.html">a.page.template</a></li>
            
                <li><a href="../classes/a.parser.json.html">a.parser.json</a></li>
            
                <li><a href="../classes/a.parser.xml.html">a.parser.xml</a></li>
            
                <li><a href="../classes/a.state.html">a.state</a></li>
            
                <li><a href="../classes/a.state.helper.chainer.html">a.state.helper.chainer</a></li>
            
                <li><a href="../classes/a.state.helper.parameter.html">a.state.helper.parameter</a></li>
            
                <li><a href="../classes/a.state.helper.tree.html">a.state.helper.tree</a></li>
            
                <li><a href="../classes/a.state.type.html">a.state.type</a></li>
            
                <li><a href="../classes/a.storage.html">a.storage</a></li>
            
                <li><a href="../classes/a.storage.cookie.html">a.storage.cookie</a></li>
            
                <li><a href="../classes/a.storage.external.html">a.storage.external</a></li>
            
                <li><a href="../classes/a.storage.memory.html">a.storage.memory</a></li>
            
                <li><a href="../classes/a.storage.persistent.html">a.storage.persistent</a></li>
            
                <li><a href="../classes/a.storage.temporary.html">a.storage.temporary</a></li>
            
                <li><a href="../classes/a.storage.type.cookie.html">a.storage.type.cookie</a></li>
            
                <li><a href="../classes/a.storage.type.flash.html">a.storage.type.flash</a></li>
            
                <li><a href="../classes/a.storage.type.globalStorage.html">a.storage.type.globalStorage</a></li>
            
                <li><a href="../classes/a.storage.type.javafx.html">a.storage.type.javafx</a></li>
            
                <li><a href="../classes/a.storage.type.localStorage.html">a.storage.type.localStorage</a></li>
            
                <li><a href="../classes/a.storage.type.memory.html">a.storage.type.memory</a></li>
            
                <li><a href="../classes/a.storage.type.sessionStorage.html">a.storage.type.sessionStorage</a></li>
            
                <li><a href="../classes/a.storage.type.silverlight.html">a.storage.type.silverlight</a></li>
            
                <li><a href="../classes/a.storage.type.userData.html">a.storage.type.userData</a></li>
            
                <li><a href="../classes/a.timer.html">a.timer</a></li>
            
        </ul>
    </div>
</div>










<div id="fileTree" class="sidebox">
    <div class="hd">
        <h2 class="no-toc">Files</h2>
    </div>
    <div class="bd">
        <ul><li>..\git\appstorm\a.js/<ul></ul></li><li>..\git\appstorm\plugin\callback.js/<ul></ul></li><li>..\git\appstorm\plugin\form.js/<ul></ul></li><li>..\git\appstorm\plugin\keyboard.js/<ul></ul></li><li>..\git\appstorm\plugin\language.js/<ul></ul></li><li>..\git\appstorm\plugin\page.js/<ul></ul></li><li>..\git\appstorm\plugin\state.js/<ul></ul></li><li>..\git\appstorm\plugin\storage.js/<ul></ul></li></ul>
    </div>
</div>



			</div>
			<div id="main" class="span9">
				<div class="content"><h4>..\git\appstorm\plugin\form.js</h4>

<pre class="code prettyprint linenums">
&quot;use strict&quot;;
/* ************************************************************************

	Version: 0.1

	License: MIT Licence

	Authors: VILLETTE Charles

	Date: 2013-07-12

	Date of last modification: 2013-07-12

	Dependencies : [
		a.js
		plugin/language.js (optional)
	]

	Events : []

	Description:
		Manipulate HTML form by with a simple system

************************************************************************ */

/**
 * Manipulate HTML form by with a simple system
 *
 * Examples: &lt;a href=&quot;http://appstormjs.com/wiki/doku.php?id=appstorm.js_v0.1:plugins:form&quot;&gt;here&lt;/a&gt;
 *
 * @class form
 * @static
 * @namespace a
*/
a.form = (function() {
	&quot;use strict&quot;;

	// HTML/HTML5 input type allowed224 
	var typePatternList = [&quot;text&quot;, &quot;search&quot;, &quot;url&quot;, &quot;tel&quot;, &quot;email&quot;, &quot;password&quot;],
		minMaxStepList = [&quot;number&quot;, &quot;range&quot;, &quot;date&quot;, &quot;datetime&quot;, &quot;datetime-local&quot;, &quot;month&quot;, &quot;time&quot;, &quot;week&quot;],
		typeRequiredList = typePatternList.concat(minMaxStepList, [&quot;number&quot;, &quot;checkbox&quot;, &quot;radio&quot;, &quot;file&quot;]),
		typeMultipleList = [&quot;email&quot;, &quot;file&quot;],
		typeList = minMaxStepList.concat(typePatternList, [&quot;color&quot;, &quot;checkbox&quot;, &quot;file&quot;, &quot;hidden&quot;, &quot;radio&quot;]);

	/**
	 * Get the attribute from it&#x27;s name
	 *
	 * @method __attr
	 * @private
	 *
	 * @param el {DOMElement} An element to get hash from
	 * @param attr {String | null} The attribute to search for that element (default : see __attr)
	 * @return {String | null} The hash tag associated (if found)
	*/
	function __attr(el, attr) {
		return (!a.isNull(el.getAttribute)) ? el.getAttribute(attr) : null;
	};

	/**
	 * Convert an HTMLCollection to array
	 *
	 * @method __htmlCollectionToArray
	 * @private
	 *
	 * @param el {HTMLCollection} The collection to convert
	 * @return {Array} An array version
	*/
	function __htmlCollectionToArray(el) {
		var ret = [],
			i   = el.length;
		while(i--) {
			ret.push(el[i]);
		}
		return ret;
	};

	/**
	 * Get the field key from given input
	 *
	 * @method __getFieldKey
	 * @private
	 *
	 * @param e {DOMElement} The element o search value inside
	 * @return {String} The value found
	*/
	function __getFieldKey(e) {
		var name  = __attr(e, &quot;name&quot;);

		// Search the good attribute in case of problem
		if(a.isNull(name) || name === &quot;&quot;) {
			name = __attr(e, &quot;id&quot;);
			// Should never appear... But we provide it in case of trouble
			if(a.isNull(name) || name === &quot;&quot;) {
				name = __attr(e, &quot;class&quot;);
			}
		}

		return name;
	};

	/**
	 * Get the field value for given input
	 *
	 * @method __getFieldValue
	 * @private
	 *
	 * @param e {DOMElement} The element to search value inside
	 * @return {String} The value found
	*/
	function __getFieldValue(e){
		var type    = __attr(e, &quot;type&quot;),
			tagName = e.tagName.toLowerCase();

		if(tagName === &quot;input&quot; || tagName === &quot;textarea&quot;) {
			return (type === &quot;checkbox&quot;) ? e.checked : e.value;
		} else if(tagName === &quot;select&quot;) {
			return e.options[e.selectedIndex].value;
		}
	};

	/**
	 * From a given dom, get the list of elements inside
	 *
	 * @method __getFieldList
	 * @private
	 *
	 * @param dom {DOMElement} The dom element to search inside
	 * @return {Array} The element list inside DOM
	*/
	function __getFieldList(dom) {
		var inputList     = dom.getElementsByTagName(&quot;input&quot;),
			textAreaList  = dom.getElementsByTagName(&quot;textarea&quot;),
			selectList    = dom.getElementsByTagName(&quot;select&quot;),
			outputList    = [];

		// We remove input who are not listed in typeList (like submit should not appear here)
		inputList = __htmlCollectionToArray(inputList);

		var i = inputList.length;
		while(i--) {
			var at = __attr(inputList[i], &quot;type&quot;);
			// We allow null type to be consider as valid (as it will be consider as &quot;text&quot; type by most of browsers)
			if(!a.contains(typeList, at) &amp;&amp; !a.isNull(at)) {
				inputList.splice(i, 1);
			}
		}

		
		// Concat everything
		return inputList.concat(
			__htmlCollectionToArray(textAreaList),
			__htmlCollectionToArray(selectList)
		);
	};

	/**
	 * Raise an error on input
	 *
	 * @method __validateError
	 * @private
	 *
	 * @param el {DOMElement} The element where comes from error
	 * @param id {String} The element id/name/class
	 * @param name {String | null} The name (like min, pattern, ...) which is not valid, can be null
	 * @param value {String | null} The current input value (can be used as parameter
	 * @return {Object} A validate object with everything inside if possible
	*/
	function __validateError(el, id, name, value) {
		// First : we need to get error element and translate if possible
		var error = &quot;&quot;;

		// Retrieve error tag
		if(!a.isNull(name) &amp;&amp; name !== &quot;&quot;) {
			error = __attr(el, &quot;data-error-&quot; + name);
		}
		if(a.isNull(error) || error === &quot;&quot;) {
			error = __attr(el, &quot;data-error&quot;);
		}

		if(a.isNull(error) || error === &quot;&quot;) {
			a.console.warn(&quot;A data-error tag has not been setted for &quot; + id + &quot; with value &quot; + value + &quot;, can&#x27;t proceed error show&quot;, 3);
		}

		// Translate error if possible
		if(!a.isNull(a.language)) {
			error = a.language.getSingleTranslation(error, {
				name : name,
				value : value
			});
		}

		// Returning an object with all needed data inside
		return {
			el : el,
			id : id,
			error : error
		};
	};

	return {
		/**
		 * Allow to skip HTML5 form-novalidate tag or not (boolean)
		 *
		 * @property skipNoValidate
		 * @type Boolean
		 * @default false
		*/
		skipNoValidate : false,

		/**
		 * Get the list of element stored into given form
		 *
		 * @method get
		 *
		 * @param dom {DOMElement} The dom element to search inside (basically it should be document.getElementById(&quot;myFormId&quot;))
		 * @return {Object} The list of input tags existing
		*/
		get : function(dom) {
			var inputList  = __getFieldList(dom),
				outputList = {};

			var i = inputList.length;
			while(i--) {
				var input = inputList[i];

				var name  = __getFieldKey(input),
					value = __getFieldValue(input);

				// We don&#x27;t continue if we don&#x27;t find any data on element
				if(name === null || name === &quot;&quot;) {
					continue;
				}

				// We got a special case with input radio type
				if(!a.isNull(input) &amp;&amp; __attr(input, &quot;type&quot;) === &quot;radio&quot;) {
					// Only checked one are validated
					if(input.checked) {
						outputList[name] = (value === &quot;&quot;) ? null : value;
					}
				} else {
					outputList[name] = (value === &quot;&quot;) ? null : value;
				}
			};

			a.console.log(&quot;a.form.get: found element list:&quot;, 3);
			a.console.log(outputList, 3);
			return outputList;
		},

		/**
		 * Validate a form
		 * Note : multiple tester (email, file) is not supported
		 * Note : date field (date, datetime, datetime-local, month, time, week) are not supported
		 * Note : tel/file field are not supported
		 *
		 * @method validate
		 *
		 * @param dom {DOMElement} The dom element to search inside (basically it should be document.getElementById(&quot;myFormId&quot;))
		 * @return {Array} An array with all errors listed inside, an empty array if there is no error to show
		*/
		validate : function(dom) {
			// On form tag, the &quot;novalidate&quot; allow to not validate a form
			if(!a.isNull(__attr(dom, &quot;novalidate&quot;)) &amp;&amp; this.skipNoValidate === false) {
				return [];
			}

			var inputList    = __getFieldList(dom),
				// Store all errors appearing
				errorList    = [],
				// TODO : after todos are ended, remove this...
				allowedTypes = [&quot;number&quot;, &quot;range&quot;, &quot;text&quot;, &quot;search&quot;, &quot;url&quot;, &quot;email&quot;, &quot;password&quot;, &quot;color&quot;, &quot;checkbox&quot;, &quot;hidden&quot;, &quot;radio&quot;],
				// Pretty basic url tester
				urlTester    = new RegExp(&quot;^[a-z]{2,}:\\/\\/([a-z0-9\\/\\.\\-_~+;:&amp;=]{2,})$&quot;, &quot;gi&quot;),
				// Pretty basic email tester
				emailTester  = new RegExp(&quot;^.{2,}@.*\\.[a-z0-9]{2,}$&quot;, &quot;gi&quot;),
				colorTester  = new RegExp(&quot;^#([a-f]{3}|[a-f]{6})$&quot;, &quot;gi&quot;);

			/*
			 * required : at least one char (text, search, url, tel, email, password, date, datetime, datetime-local, month, time, week, number, checkbox, radio, file)
			 * pattern : a regex to test (Use title like a helper), (text, search, url, tel, email, password)
			 * multiple : the user is allowed to enter more than one element (only for email, file)
			 * min/max : min/max value (number, range, date, datetime, datetime-local, month, time, week)
			 * step : multiplicateur (The step attribute works with the following input types: number, range, date, datetime, datetime-local, month, time, week)
			*/
			var i = inputList.length;
			while(i--) {
				// Does only work for input tags
				var el      = inputList[i],
					tagName = el.tagName.toLowerCase();

				// formnovalidate : we must not validate this element (including all select)
				if(tagName === &quot;select&quot; || !a.isNull(__attr(el, &quot;formnovalidate&quot;))) {
					continue;
				}

				var type     = __attr(el, &quot;type&quot;),
					name    = __getFieldKey(el),
					value    = el.value,

					required = __attr(el, &quot;required&quot;),
					pattern  = __attr(el, &quot;pattern&quot;),
					multiple = __attr(el, &quot;multiple&quot;),
					min      = __attr(el, &quot;min&quot;),
					max      = __attr(el, &quot;max&quot;),
					step     = __attr(el, &quot;step&quot;);

				// Double check float data
				min  = (a.isNull(min) || min === &quot;&quot;)   ? null : parseFloat(min);
				max  = (a.isNull(max) || max === &quot;&quot;)   ? null : parseFloat(max);
				step = (a.isNull(step) || step === &quot;&quot;) ? null : parseFloat(step);

				// Check input type does existing in allowed type list
				if(tagName === &quot;input&quot; &amp;&amp; !a.contains(allowedTypes, type) &amp;&amp; !a.isNull(type)) {
					a.console.warn(&quot;Type &quot; + type + &quot; for input &quot; + name + &quot; not recognized or not supported&quot;, 3);
					continue;
				}

				// Now checking type
				if( (type === &quot;number&quot; || type === &quot;range&quot;) &amp;&amp; !a.isNumber(value) ) {
					errorList.push(__validateError(el, name, null, value));
					continue;
				}
				if(type === &quot;url&quot; &amp;&amp; !urlTester.test(value) ) {
					errorList.push(__validateError(el, name, null, value));
					continue;
				}
				if(type === &quot;email&quot; &amp;&amp; !emailTester.test(value) ) {
					errorList.push(__validateError(el, name, null, value));
					continue;
				}
				if(type === &quot;color&quot; &amp;&amp; !colorTester.test(value) ) {
					errorList.push(__validateError(el, name, null, value));
					continue;
				}

				// Required test
				if( required !== null &amp;&amp; a.contains(typeRequiredList, type) &amp;&amp; (value === &quot;&quot; || a.isNull(value)) ) {
					errorList.push(__validateError(el, name, &quot;required&quot;, value));
					continue;
				}

				// Pattern test
				if( pattern !== null &amp;&amp; (tagName === &quot;textarea&quot; || (a.contains(typePatternList, type)) || a.isNull(type)) ) {
					var reg = new RegExp(pattern);
					if(!reg.test(value)) {
						errorList.push(__validateError(el, name, &quot;pattern&quot;, value));
						continue;
					}
				}

				// Min/max/step test
				if( (min !== null || max != null || step != null) &amp;&amp; a.contains(minMaxStepList, type) ) {
					var pval = parseFloat(value);
					if( min !== null &amp;&amp; pval &lt; min ) {
						errorList.push(__validateError(el, name, &quot;min&quot;, value));
						continue;
					}
					if( max !== null &amp;&amp; pval &gt; max ) {
						errorList.push(__validateError(el, name, &quot;max&quot;, value));
						continue;
					}
					if( step !== null &amp;&amp; pval % step !== 0 ) {
						errorList.push(__validateError(el, name, &quot;step&quot;, value));
						continue;
					}
				}
			}

			a.console.log(&quot;a.form.validate: found error list:&quot;, 3);
			a.console.log(errorList, 3);
			return errorList;
		},

		/**
		 * Validate and get the form content
		 *
		 * @method validateAndGet
		 *
		 * @param dom {DOMElement} The dom element to search inside (basically it should be document.getElementById(&quot;myFormId&quot;))
		 * @return {Object} An object with error (boolean), errorList (Array), and contentList (Array)
		*/
		validateAndGet : function(dom) {
			var obj = {
				errorList   : this.validate(dom),
				error       : false,
				contentList : this.get(dom)
			};
			if(obj.errorList.length &gt; 0) {
				obj.error = true;
			}
			return obj;
		}
	};

})();
</pre>

</div>
			</div>
		</div>
    </div>
</div>
<script src="../assets/vendor/prettify/prettify-min.js"></script>
<script>prettyPrint();</script>
<script src="../assets/js/yui-prettify.js"></script>
<script src="../assets/js/tabs.js"></script>
</body>
</html>
